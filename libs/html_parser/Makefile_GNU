OBJ = start.o \
	  line_parser.o \
	  command_parsing.o \
	  exec_if.o \
	  exec_macro.o \
	  for.o \
	  for_cmd.o \
	  for_startvalues.o \
	  if.o \
	  json.o \
	  macro.o \
	  token_handling.o \
	  variablen_parsing.o \
	  variablen_handling.o

INCLUDE = -I./src/ \
		  -I../varhandle_lib/src/ \
		  -I../utils/src/

LIBS = -L../varhandle_lib/ -lvars \
	   -L../utils/ -lutils


lib: $(OBJ)
	gcc -g3 -o ./main $(INCLUDE) test_src/main.c ./bin/*.o $(LIBS)
	
%.o: ./src/%.c
	gcc -g3 -c $< $(INCLUDE) -o ./bin/$@

test: lib check_mem
	@echo "Done..."

check_mem:
	valgrind \
		--leak-check=full \
		--show-leak-kinds=all \
		--track-origins=yes \
		./main 1> valgrind.log 2>&1

clean:
	rm -rf libvars.a
	rm -rf ./bin/*.o
