CC = xlc

OBJ = ncuxinit.o getvar.o printvars.o gen_page.o gen_json.o gen_json_objs.o jumptab.o natutils.o 
VAR_OBJ = a_handling.o n_handling.o l_handling.o i_handling.o u_handling.o
NATUSER_HANDLING_OBJ = json_i_handler.o json_a_handler.o json_aton_handler.o json_l_handler.o json_f_handler.o


INCLUDE = -I./include/ \
		  -I../include/ \
		  -I../libs/varhandle_lib/src/ \
		  -I../libs/utils/src/ \
		  -I../libs/hexdump/src/ \
		  -I../libs/nat-lda-parser/src/ \
		  -I../libs/html_parser/src/ \
		  -I../var2names/src/ \
		  -I../libs/json_generator/include/


LIBS = -L../libs/varhandle_lib/ -lvars \
	   -L../libs/utils/ -lutils \
	   -L../libs/nat-lda-parser/ -lldaparser \
	   -L../libs/html_parser/ -lhtml_parser \
	   -L../var2names/ -lvar2name \
	   -L../libs/json_generator/ -lgenjson

#	   -L../libs/hexdump/ -lhexdump \

LFLAGS1 = -G -bsymbolic -bexpall -bnoentry
LFLAGS2 = -b64 -ldl -blibpath:/usr/lib/threads:/usr/lib:/lib -lc_r

lib: clean $(OBJ)
	@printf "Linking librealHTML4Natural.so\n"
	@$(CC) $(LFLAGS1) ./bin/*.o $(LIBS) $(LFLAGS2) -o ../bin/librealHTML4Natural.so
	
$(OBJ): $(VAR_OBJ) $(NATUSER_HANDLING_OBJ)
	@printf "CC ./src/$*.c => ./bin/$*.o\n"
	@$(CC) -g -fpic -c -q64 ./src/$*.c $(INCLUDE) -o ./bin/$*.o

$(VAR_OBJ):
	@printf "CC ./src/variablen_handling/$*.c => ./bin/$*.o\n"
	@$(CC) -g -fpic -c -q64 ./src/variablen_handling/$*.c $(INCLUDE) -o ./bin/$*.o

$(NATUSER_HANDLING_OBJ):
	@printf "CC ./src/json_handlers/$*.c => ./bin/$*.o\n"
	@$(CC) -g -fpic -c -q64 ./src/json_handlers/$*.c $(INCLUDE) -o ./bin/$*.o

clean:
	@printf "Cleaning shared objects\n"
	@rm -rf ../bin/librealHTML4Natural.so
	@printf "Cleaning objects\n"
	@rm -rf ./bin/*.o

test:
	make lib
	gcc -g ./test_src/main.c $(INCLUDE) -o ./test -L./ -lldaparser -I./src/ $(LIBS)

callnat:
	export NATUSER=/u/it/a140734/rh4n/realHTML4Natural/natuser_lib/librealHTML4Natural.so \
		&& natural parm=logiparm etid=$$$$ STACK="(logon tgap0734;testcall;fin)"
	cat /tmp/TESTLDA.log
