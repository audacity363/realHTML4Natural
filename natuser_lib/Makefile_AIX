CC = xlc

NATUSER_OBJS = rh4n_nat_jumptab.o \
			   ncuxinit.o \
			   rh4n_nat_genjson.o \
			   rh4n_nat_init.o \
			   rh4n_nat_utils.o \
			   rh4n_nat_variablereadout.o \
			   rh4n_nat_geturlobj.o \
			   rh4n_nat_variableallocation.o
			   
NATUSER_READOUT_OBJS = rh4n_nat_a_handling.o \
					   rh4n_nat_i_handling.o \
					   rh4n_nat_l_handling.o \
					   rh4n_nat_f_handling.o \
					   rh4n_nat_dt_handling.o \
					   rh4n_nat_np_handling.o \
					   rh4n_nat_u_handling.o

NATUSER_PUTVAR_OBJS = rh4n_nat_put_a.o \
					  rh4n_nat_put_i.o \
					  rh4n_nat_put_l.o \
					  rh4n_nat_put_f.o \
					  rh4n_nat_put_aton.o



INCLUDE = -I./include/ \
          -I../include/ \
		  -I../libs/rh4n_logging/include/ \
          -I../libs/rh4n_utils/include/ \
		  -I../libs/rh4n_vars/include/ \
		  -I../libs/rh4n_var2name/include/ \
		  -I../libs/rh4n_ldaparser/include/

LIBS = -L../libs/rh4n_logging/ -lrh4nlogging \
       -L../libs/rh4n_utils/ -lrh4nutils \
	   -L../libs/rh4n_vars/ -lrh4nvars \
	   -L../libs/rh4n_var2name/ -lrh4nvar2name \
	   -L../libs/rh4n_ldaparser/ -lrh4nldaparser

LFLAGS1 = -G -bsymbolic -bexpall -bnoentry
LFLAGS2 = -b64 -ldl -blibpath:/usr/lib/threads:/usr/lib:/lib -lc_r
WARNING_FLAGS = -qinfo=all:nocmp:nogen:nolan:noppc:noppt:notru:notrx:nouni:noupg:nozea
SO_CFLAGS = $(WARNING_FLAGS) -c -g -q64 -fpic $(INCLUDE)

lib: clean $(NATUSER_OBJS) $(NATUSER_READOUT_OBJS) $(NATUSER_PUTVAR_OBJS)
	@printf "Linking realHTML4Natural.so\n"
	@$(CC) $(LFLAGS1) ./bin/*.o $(LIBS) $(LFLAGS2) -o ./realHTML4Natural.so
	@printf "Done....\n"
	#@dump -Tv realHTML4Natural.so | grep undef | grep "\.\." 

$(NATUSER_OBJS): 
	@printf "CC ./src/$*.c => ./bin/$*.o\n"
	@$(CC) $(SO_CFLAGS) -o ./bin/$*.o ./src/$*.c

$(NATUSER_READOUT_OBJS): 
	@printf "CC ./src/var_parm_handling/$*.c => ./bin/$*.o\n"
	@$(CC) $(SO_CFLAGS) -o ./bin/$*.o ./src/var_parm_handling/$*.c

$(NATUSER_PUTVAR_OBJS):
	@printf "CC ./src/put_var_handling/$*.c => ./bin/$*.o\n"
	@$(CC) $(SO_CFLAGS) -o ./bin/$*.o ./src/put_var_handling/$*.c

genjsontest: lib
	@printf "CC ./test/rh4n_nat_test_genjson.c => ./test/rh4n_nat_test_genjson\n"
	@$(CC) -g $(INCLUDE) -o ./test/rh4n_nat_test_genjson ./test/rh4n_nat_test_genjson.c $(LIBS)
	@rm -f ./logs/rh4n_TGAP0734_RH4NTEST_`date +%d.%m.%Y`.log
	@export NATUSER=/u/it/a140734/rh4n/realHTML4Natural/natuser_lib/realHTML4Natural.so; \
	 ./test/rh4n_nat_test_genjson
	@cat ./logs/rh4n_TGAP0734_RH4NTEST_`date +%d.%m.%Y`.log




clean:
	@printf "Cleaning natuser objects\n"
	@rm -f ./bin/*.o
	@printf "Cleaning realHTML4Natural.so\n"
	@rm -f ./realHTML4Natural.so


